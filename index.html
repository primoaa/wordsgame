<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ø¯ÙŠ Ø§Ù„Ø­Ø±ÙˆÙ - Ø§Ø³Ù… Ø­ÙŠÙˆØ§Ù† Ù†Ø¨Ø§Øª Ø¬Ù…Ø§Ø¯ Ø¨Ù„Ø§Ø¯</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #1a1a2e;
            --secondary-bg: #16213e;
            --accent-blue: #4361ee;
            --accent-purple: #7209b7;
            --accent-pink: #f72585;
            --accent-green: #06d6a0;
            --accent-red: #ef233c;
            --accent-yellow: #ffd60a;
            --accent-orange: #fb8500;
            --accent-cyan: #00b4d8;
            --accent-lime: #84cc16;
            --text-white: #ffffff;
            --text-gray: #a0a0a0;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --border-radius: 20px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, var(--primary-bg) 0%, var(--secondary-bg) 50%, #0f0f23 100%);
            min-height: 100vh;
            color: var(--text-white);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Welcome Screen */
        #welcome-screen {
            justify-content: center;
            align-items: center;
            text-align: center;
            gap: 40px;
        }

        .logo {
            font-size: 3.5rem;
            font-weight: 900;
            color: #a855f7;
            text-shadow: 0 0 30px rgba(168, 85, 247, 0.6);
        }

        .subtitle {
            font-size: 1.3rem;
            color: var(--text-gray);
            margin-top: 10px;
        }

        .categories-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .category-badge {
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.95rem;
        }

        .welcome-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Buttons */
        .btn {
            padding: 16px 35px;
            border: none;
            border-radius: 15px;
            font-family: 'Cairo', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(67, 97, 238, 0.6);
        }

        .btn-secondary {
            background: var(--glass-bg);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        .btn-stop {
            background: linear-gradient(135deg, var(--accent-red), #d90429);
            color: white;
            font-size: 1.4rem;
            padding: 18px 50px;
        }

        .btn-stop:hover {
            transform: scale(1.05);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Room Screen */
        #room-screen {
            justify-content: center;
            align-items: center;
            gap: 30px;
        }

        .room-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 35px;
            width: 100%;
            max-width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .room-card h2 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.6rem;
        }

        .input-group {
            margin-bottom: 18px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-gray);
        }

        .input-group input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-family: 'Cairo', sans-serif;
            font-size: 1.05rem;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .room-code {
            font-size: 2.2rem;
            font-weight: 900;
            letter-spacing: 5px;
            color: var(--accent-blue);
            text-align: center;
            margin: 15px 0;
        }

        /* Waiting Screen */
        #waiting-screen {
            justify-content: center;
            align-items: center;
            gap: 30px;
            text-align: center;
        }

        .waiting-animation {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .waiting-dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent-blue);
            animation: waitingBounce 1.4s ease-in-out infinite;
        }

        .waiting-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .waiting-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes waitingBounce {

            0%,
            80%,
            100% {
                transform: scale(0.8);
                opacity: 0.5;
            }

            40% {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        /* Game Screen */
        #game-screen {
            gap: 15px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 10px 0;
        }

        .letter-display {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            padding: 15px 35px;
            border-radius: var(--border-radius);
            text-align: center;
        }

        .letter-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .current-letter {
            font-size: 3.5rem;
            font-weight: 900;
            line-height: 1;
        }

        .timer-display {
            background: var(--glass-bg);
            padding: 15px 35px;
            border-radius: var(--border-radius);
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .timer-label {
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        .timer-value {
            font-size: 3rem;
            font-weight: 900;
            color: var(--accent-yellow);
        }

        .timer-value.warning {
            color: var(--accent-orange);
        }

        .timer-value.danger {
            color: var(--accent-red);
            animation: pulse 0.5s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        /* Categories Grid - 9 categories in 3 rows */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin: 10px 0;
        }

        .category-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-3px);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .category-card:focus-within {
            border-color: var(--accent-blue);
            box-shadow: 0 0 20px rgba(67, 97, 238, 0.3);
        }

        .category-header {
            padding: 10px;
            text-align: center;
            font-weight: 700;
            font-size: 1rem;
        }

        .category-body {
            padding: 12px;
        }

        .category-input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-family: 'Cairo', sans-serif;
            font-size: 1.1rem;
            text-align: center;
        }

        .category-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.1);
        }

        .category-input::placeholder {
            color: rgba(255, 255, 255, 0.3);
            font-size: 1.5rem;
        }

        .game-actions {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }

        /* Category Colors */
        .cat-boy-name .category-header {
            background: var(--accent-red);
        }

        .cat-girl-name .category-header {
            background: var(--accent-pink);
        }

        .cat-vegetable .category-header {
            background: var(--accent-green);
        }

        .cat-fruit .category-header {
            background: var(--accent-lime);
        }

        .cat-object .category-header {
            background: #6c757d;
        }

        .cat-animal .category-header {
            background: var(--accent-blue);
        }

        .cat-country .category-header {
            background: var(--accent-purple);
        }

        .cat-city .category-header {
            background: var(--accent-cyan);
        }

        .cat-job .category-header {
            background: var(--accent-orange);
        }

        /* Results Screen */
        #results-screen {
            align-items: center;
            gap: 25px;
            padding: 30px 20px;
            overflow-y: auto;
        }

        .results-title {
            font-size: 2.2rem;
            color: var(--accent-yellow);
        }

        .winner-banner {
            background: linear-gradient(135deg, var(--accent-yellow), var(--accent-orange));
            color: var(--primary-bg);
            padding: 18px 35px;
            border-radius: var(--border-radius);
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .results-container {
            width: 100%;
            max-width: 1000px;
        }

        .player-results {
            background: var(--glass-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .player-name {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .player-score {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--accent-yellow);
        }

        .answers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }

        .answer-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 8px;
            border-radius: 10px;
            text-align: center;
        }

        .answer-category {
            font-size: 0.8rem;
            color: var(--text-gray);
            margin-bottom: 4px;
        }

        .answer-value {
            font-size: 1rem;
            font-weight: 600;
            word-break: break-word;
        }

        .answer-value.correct {
            color: var(--accent-green);
        }

        .answer-value.wrong {
            color: var(--accent-red);
        }

        .answer-points {
            font-size: 0.8rem;
            margin-top: 4px;
        }

        .answer-points.positive {
            color: var(--accent-green);
        }

        .results-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* AI Verification Loading */
        .ai-loading {
            text-align: center;
            padding: 30px;
        }

        .ai-loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--accent-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            padding: 15px 30px;
            border-radius: 50px;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success {
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
        }

        .toast.error {
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
        }

        /* Friends System */
        .friends-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 5px 20px rgba(67, 97, 238, 0.4);
            transition: all 0.3s ease;
        }

        .friends-toggle:hover {
            transform: scale(1.1);
        }

        .friends-toggle .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent-red);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .friends-sidebar {
            position: fixed;
            top: 0;
            left: -350px;
            width: 320px;
            height: 100vh;
            background: rgba(22, 33, 62, 0.98);
            backdrop-filter: blur(20px);
            z-index: 1000;
            transition: left 0.3s ease;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .friends-sidebar.open {
            left: 0;
        }

        .friends-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .friends-header h3 {
            font-size: 1.3rem;
        }

        .close-sidebar {
            background: none;
            border: none;
            color: var(--text-gray);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .friends-tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .friends-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: var(--text-gray);
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .friends-tab.active {
            color: var(--accent-blue);
            border-bottom: 2px solid var(--accent-blue);
        }

        .friends-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .add-friend-section {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .add-friend-section input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-family: 'Cairo', sans-serif;
        }

        .add-friend-section button {
            padding: 10px 15px;
            border: none;
            border-radius: 10px;
            background: var(--accent-green);
            color: white;
            cursor: pointer;
            font-weight: 600;
        }

        .friend-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .friend-card:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .friend-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .friend-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .friend-name {
            font-weight: 600;
        }

        .friend-status {
            font-size: 0.8rem;
            color: var(--text-gray);
        }

        .friend-status.online {
            color: var(--accent-green);
        }

        .friend-actions {
            display: flex;
            gap: 8px;
        }

        .friend-actions button {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-invite {
            background: var(--accent-green);
            color: white;
        }

        .btn-invite:hover {
            transform: scale(1.1);
        }

        .btn-accept {
            background: var(--accent-green);
            color: white;
        }

        .btn-reject {
            background: var(--accent-red);
            color: white;
        }

        .my-id-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .my-id-section label {
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        .my-id-section .user-id {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--accent-blue);
            word-break: break-all;
            margin: 8px 0;
        }

        .my-id-section button {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            background: var(--accent-blue);
            color: white;
            cursor: pointer;
            font-size: 0.85rem;
        }

        /* Invite Modal */
        .invite-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .invite-modal.show {
            display: flex;
        }

        .invite-modal-content {
            background: var(--secondary-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: fadeIn 0.3s ease;
        }

        .invite-modal-content h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .invite-modal-content p {
            color: var(--text-gray);
            margin-bottom: 20px;
        }

        .invite-modal-content .invite-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .invite-waiting {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: var(--text-gray);
            margin-top: 15px;
        }

        .invite-waiting .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            color: var(--text-gray);
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        /* Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .sidebar-overlay.show {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .logo {
                font-size: 2.5rem;
            }

            .categories-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .current-letter {
                font-size: 2.5rem;
            }

            .timer-value {
                font-size: 2rem;
            }

            .friends-sidebar {
                width: 100%;
                left: -100%;
            }

            .friends-toggle {
                top: 15px;
                left: 15px;
                width: 45px;
                height: 45px;
            }

            .chat-panel {
                width: 100%;
                right: 0;
                border-radius: 20px 20px 0 0;
            }
        }

        /* Chat System */
        .chat-panel {
            position: fixed;
            bottom: 0;
            right: 20px;
            width: 350px;
            height: 450px;
            background: rgba(22, 33, 62, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px 20px 0 0;
            display: flex;
            flex-direction: column;
            z-index: 2000;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.3);
        }

        .chat-panel.hidden {
            display: none;
        }

        .chat-header {
            padding: 15px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-weight: 700;
        }

        .chat-header-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-header-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .chat-close:hover {
            opacity: 1;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chat-message {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .chat-message.me {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .chat-message.friend {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .chat-message .time {
            font-size: 0.7rem;
            opacity: 0.6;
            margin-top: 5px;
            display: block;
        }

        .chat-typing {
            padding: 5px 15px;
            font-size: 0.8rem;
            color: var(--text-gray);
            font-style: italic;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-input-area input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 25px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-family: 'Cairo', sans-serif;
            font-size: 0.95rem;
        }

        .chat-input-area input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .chat-send-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .chat-send-btn:hover {
            transform: scale(1.1);
        }

        .chat-date-divider {
            text-align: center;
            color: var(--text-gray);
            font-size: 0.75rem;
            margin: 10px 0;
        }

        .chat-empty {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-gray);
            text-align: center;
            padding: 20px;
        }

        .chat-empty .icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        /* Chat button in friend card */
        .btn-chat {
            background: var(--accent-blue);
            color: white;
        }

        .btn-chat:hover {
            transform: scale(1.1);
        }

        .chat-unread-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent-red);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body>
    <!-- Friends Toggle Button -->
    <button class="friends-toggle" id="friends-toggle">
        ğŸ‘¥
        <span class="notification-badge" id="notification-badge" style="display:none;">0</span>
    </button>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Friends Sidebar -->
    <div class="friends-sidebar" id="friends-sidebar">
        <div class="friends-header">
            <h3>ğŸ‘¥ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h3>
            <button class="close-sidebar" id="close-sidebar">âœ•</button>
        </div>

        <div class="friends-tabs">
            <button class="friends-tab active" data-tab="friends">Ø£ØµØ¯Ù‚Ø§Ø¦ÙŠ</button>
            <button class="friends-tab" data-tab="requests">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
            <button class="friends-tab" data-tab="add">Ø¥Ø¶Ø§ÙØ©</button>
        </div>

        <div class="friends-content">
            <!-- My ID Section (shown in Add tab) -->
            <div id="my-id-section" class="my-id-section" style="display:none;">
                <label>ğŸ†” Ù…Ø¹Ø±Ù‘ÙÙƒ Ù„Ù„Ø£ØµØ¯Ù‚Ø§Ø¡:</label>
                <div class="user-id" id="my-user-id"></div>
                <button id="copy-my-id">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù…Ø¹Ø±Ù‘Ù</button>
            </div>

            <!-- Add Friend Section -->
            <div id="add-friend-section" class="add-friend-section" style="display:none;">
                <input type="text" id="friend-id-input" placeholder="Ù…Ø¹Ø±Ù‘Ù Ø§Ù„ØµØ¯ÙŠÙ‚...">
                <button id="send-friend-request">Ø¥Ø¶Ø§ÙØ©</button>
            </div>

            <!-- Friends List -->
            <div id="friends-list"></div>

            <!-- Requests List -->
            <div id="requests-list" style="display:none;"></div>
        </div>
    </div>

    <!-- Invite Modal -->
    <div class="invite-modal" id="invite-modal">
        <div class="invite-modal-content">
            <h3>ğŸ“© Ø¯Ø¹ÙˆØ© Ù„Ù„Ø¹Ø¨!</h3>
            <p id="invite-message"></p>
            <div class="invite-buttons">
                <button class="btn btn-primary" id="accept-invite">âœ… Ù‚Ø¨ÙˆÙ„</button>
                <button class="btn btn-secondary" id="reject-invite">âŒ Ø±ÙØ¶</button>
            </div>
        </div>
    </div>

    <!-- Invite Waiting Modal -->
    <div class="invite-modal" id="invite-waiting-modal">
        <div class="invite-modal-content">
            <h3>ğŸ“¤ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯Ø¹ÙˆØ©</h3>
            <p>ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø¯ <span id="invited-friend-name"></span>...</p>
            <div class="invite-waiting">
                <div class="spinner"></div>
                <span id="invite-countdown">15</span> Ø«Ø§Ù†ÙŠØ© Ù…ØªØ¨Ù‚ÙŠØ©
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-secondary" id="cancel-invite">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¯Ø¹ÙˆØ©</button>
            </div>
        </div>
    </div>

    <!-- Chat Panel -->
    <div class="chat-panel hidden" id="chat-panel">
        <div class="chat-header">
            <div class="chat-header-info">
                <div class="chat-header-avatar" id="chat-avatar">?</div>
                <span id="chat-friend-name">ğŸ’¬ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</span>
            </div>
            <button class="chat-close" id="chat-close">âœ•</button>
        </div>

        <div class="chat-messages" id="chat-messages">
            <div class="chat-empty">
                <div>
                    <div class="icon">ğŸ’¬</div>
                    <p>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©!</p>
                </div>
            </div>
        </div>

        <div class="chat-typing" id="chat-typing" style="display:none;">
            ÙŠÙƒØªØ¨...
        </div>

        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." maxlength="500">
            <button class="chat-send-btn" id="chat-send">â¤</button>
        </div>
    </div>

    <div class="container">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active">
            <div>
                <h1 class="logo">ØªØ­Ø¯ÙŠ Ø§Ù„Ø­Ø±ÙˆÙ</h1>
                <p class="subtitle">Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ© Ø¨Ø¥ØµØ¯Ø§Ø± Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
            </div>
            <div class="categories-preview">
                <span class="category-badge" style="background:var(--accent-red)">Ø§Ø³Ù… ÙˆÙ„Ø¯</span>
                <span class="category-badge" style="background:var(--accent-pink)">Ø§Ø³Ù… Ø¨Ù†Øª</span>
                <span class="category-badge" style="background:var(--accent-green)">Ø®Ø¶Ø§Ø±</span>
                <span class="category-badge" style="background:var(--accent-lime)">ÙÙˆØ§ÙƒÙ‡</span>
                <span class="category-badge" style="background:#6c757d">Ø¬Ù…Ø§Ø¯</span>
                <span class="category-badge" style="background:var(--accent-blue)">Ø­ÙŠÙˆØ§Ù†</span>
                <span class="category-badge" style="background:var(--accent-purple)">Ø¨Ù„Ø§Ø¯</span>
                <span class="category-badge" style="background:var(--accent-cyan)">Ù…Ø¯ÙŠÙ†Ø©</span>
                <span class="category-badge" style="background:var(--accent-orange)">Ù…Ù‡Ù†Ø©</span>
            </div>
            <div class="welcome-buttons">
                <button class="btn btn-primary" id="create-room-btn">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
                <button class="btn btn-secondary" id="join-room-btn">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©</button>
            </div>
        </div>

        <!-- Room Screen -->
        <div id="room-screen" class="screen">
            <button class="btn btn-secondary" id="back-to-welcome" style="align-self:flex-start;">â†’ Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
            <div class="room-card" id="create-room-card" style="display:none;">
                <h2>ğŸ® Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <div class="input-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨</label>
                    <input type="text" id="create-player-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ..." maxlength="20">
                </div>
                <button class="btn btn-primary" id="confirm-create-room" style="width:100%;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©</button>
                <div id="created-room-info" style="display:none;margin-top:20px;">
                    <p style="text-align:center;color:var(--text-gray);">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©:</p>
                    <div class="room-code" id="room-code-display"></div>
                    <button class="btn btn-secondary" id="copy-room-code" style="width:100%;margin-top:10px;">ğŸ“‹ Ù†Ø³Ø®
                        Ø§Ù„ÙƒÙˆØ¯</button>
                </div>
            </div>
            <div class="room-card" id="join-room-card" style="display:none;">
                <h2>ğŸšª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©</h2>
                <div class="input-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨</label>
                    <input type="text" id="join-player-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ..." maxlength="20">
                </div>
                <div class="input-group">
                    <label>ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</label>
                    <input type="text" id="room-code-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯..." maxlength="6"
                        style="text-transform:uppercase;letter-spacing:3px;text-align:center;">
                </div>
                <button class="btn btn-primary" id="confirm-join-room" style="width:100%;">Ø§Ù†Ø¶Ù…Ø§Ù…</button>
            </div>
        </div>

        <!-- Waiting Screen -->
        <div id="waiting-screen" class="screen">
            <h2>â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¢Ø®Ø±...</h2>
            <div class="waiting-animation">
                <div class="waiting-dot"></div>
                <div class="waiting-dot"></div>
                <div class="waiting-dot"></div>
            </div>
            <p>ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©: <span id="waiting-room-code" style="color:var(--accent-blue);font-weight:700;"></span></p>
            <p id="players-count">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†: 1/2</p>
            <button class="btn btn-secondary" id="leave-room-btn">Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©</button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-header">
                <div class="letter-display">
                    <div class="letter-label">Ø§Ù„Ø­Ø±Ù</div>
                    <div class="current-letter" id="current-letter">Ø£</div>
                </div>
                <div class="timer-display">
                    <div class="timer-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                    <div class="timer-value" id="timer-value">60</div>
                </div>
            </div>
            <div class="categories-grid" id="categories-container"></div>
            <div class="game-actions">
                <button class="btn btn-stop" id="stop-btn">ğŸ›‘ STOP</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <h2 class="results-title">ğŸ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
            <div class="winner-banner" id="winner-banner"></div>
            <div class="results-container" id="results-container"></div>
            <div class="results-actions">
                <button class="btn btn-primary" id="play-again-btn">ğŸ”„ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                <button class="btn btn-secondary" id="exit-game-btn">ğŸšª Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>
    </div>
    <div class="toast" id="toast"></div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyAwdE4U_ycmvpPhUt1qh4IUGxB1bJgh5as",
            authDomain: "word-game-7451f.firebaseapp.com",
            databaseURL: "https://word-game-7451f-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "word-game-7451f",
            storageBucket: "word-game-7451f.firebasestorage.app",
            messagingSenderId: "824692932627",
            appId: "1:824692932627:web:9250e379d5455a85ce3fe6"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
        // Ø§Ø³ØªØ®Ø¯Ù… Cloudflare Worker Ù„Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ GitHub Pages
        const WORKER_URL = "https://shiny-term-8522.ahanfouf9.workers.dev";

        // Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø· (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Worker)
        const GEMINI_API_KEY = "";

        // Game Variables
        let currentRoomId = null, currentPlayerId = null, playerName = '', isHost = false;
        let gameTimerInterval = null, currentTimeLeft = 60;

        // Categories Definition
        const categories = [
            { id: 'boyName', label: 'Ø§Ø³Ù… ÙˆÙ„Ø¯', class: 'cat-boy-name', prompt: 'Ø§Ø³Ù… ÙˆÙ„Ø¯ (Ø°ÙƒØ±)' },
            { id: 'girlName', label: 'Ø§Ø³Ù… Ø¨Ù†Øª', class: 'cat-girl-name', prompt: 'Ø§Ø³Ù… Ø¨Ù†Øª (Ø£Ù†Ø«Ù‰)' },
            { id: 'vegetable', label: 'Ø®Ø¶Ø§Ø±', class: 'cat-vegetable', prompt: 'Ù†ÙˆØ¹ Ø®Ø¶Ø§Ø±' },
            { id: 'fruit', label: 'ÙÙˆØ§ÙƒÙ‡', class: 'cat-fruit', prompt: 'Ù†ÙˆØ¹ ÙØ§ÙƒÙ‡Ø©' },
            { id: 'object', label: 'Ø¬Ù…Ø§Ø¯', class: 'cat-object', prompt: 'Ø¬Ù…Ø§Ø¯ (Ø´ÙŠØ¡ ØºÙŠØ± Ø­ÙŠ)' },
            { id: 'animal', label: 'Ø­ÙŠÙˆØ§Ù†', class: 'cat-animal', prompt: 'Ø§Ø³Ù… Ø­ÙŠÙˆØ§Ù†' },
            { id: 'country', label: 'Ø¨Ù„Ø§Ø¯', class: 'cat-country', prompt: 'Ø§Ø³Ù… Ø¯ÙˆÙ„Ø©/Ø¨Ù„Ø¯' },
            { id: 'city', label: 'Ù…Ø¯ÙŠÙ†Ø©', class: 'cat-city', prompt: 'Ø§Ø³Ù… Ù…Ø¯ÙŠÙ†Ø©' },
            { id: 'job', label: 'Ù…Ù‡Ù†Ø©', class: 'cat-job', prompt: 'Ø§Ø³Ù… Ù…Ù‡Ù†Ø©/ÙˆØ¸ÙŠÙØ©' }
        ];

        const arabicLetters = ['Ø£', 'Ø§', 'Ø¨', 'Øª', 'Ø«', 'Ø¬', 'Ø­', 'Ø®', 'Ø¯', 'Ø°', 'Ø±', 'Ø²', 'Ø³', 'Ø´', 'Øµ', 'Ø¶', 'Ø·', 'Ø¸', 'Ø¹', 'Øº', 'Ù', 'Ù‚', 'Ùƒ', 'Ù„', 'Ù…', 'Ù†', 'Ù‡', 'Ùˆ', 'ÙŠ'];

        // Initialize categories UI
        function initCategoriesUI() {
            const container = document.getElementById('categories-container');
            container.innerHTML = categories.map(cat => `
                <div class="category-card ${cat.class}">
                    <div class="category-header">${cat.label}</div>
                    <div class="category-body">
                        <input type="text" class="category-input" id="input-${cat.id}" placeholder="ØŸ" autocomplete="off">
                    </div>
                </div>
            `).join('');
        }
        initCategoriesUI();

        // Helper Functions
        const screens = { welcome: document.getElementById('welcome-screen'), room: document.getElementById('room-screen'), waiting: document.getElementById('waiting-screen'), game: document.getElementById('game-screen'), results: document.getElementById('results-screen') };

        function showScreen(name) { Object.values(screens).forEach(s => s.classList.remove('active')); screens[name].classList.add('active'); }
        function showToast(msg, type = 'success') { const t = document.getElementById('toast'); t.textContent = msg; t.className = `toast ${type} show`; setTimeout(() => t.classList.remove('show'), 3000); }
        function generateRoomCode() { const c = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'; let r = ''; for (let i = 0; i < 6; i++) r += c[Math.floor(Math.random() * c.length)]; return r; }
        function generatePlayerId() { return 'p_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6); }
        function getRandomLetter() { return arabicLetters[Math.floor(Math.random() * arabicLetters.length)]; }

        function normalizeArabic(letter) {
            const n = { 'Ø£': 'Ø§', 'Ø¥': 'Ø§', 'Ø¢': 'Ø§', 'Ø©': 'Ù‡', 'Ù‰': 'ÙŠ' };
            return n[letter] || letter;
        }

        function getFirstLetter(word) {
            if (!word || !word.trim()) return '';
            let w = word.trim();
            if (w.startsWith('Ø§Ù„') && w.length > 2) w = w.substring(2);
            return normalizeArabic(w.charAt(0));
        }

        // AI Verification with Gemini
        async function verifyWithAI(answers, letter) {
            const results = {};
            let totalScore = 0;

            // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ø·ÙˆÙ„ Ø§Ù„ÙƒÙ„Ù…Ø© (Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)
            const MIN_WORD_LENGTH = 2;

            // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ - ÙŠØ¬Ø¨ Ø£Ù† ØªØ¨Ø¯Ø£ Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø­Ø±Ù Ø§Ù„ØµØ­ÙŠØ­
            function basicValidation(answer, letter) {
                const trimmed = answer.trim();
                if (trimmed.length < MIN_WORD_LENGTH) return false;
                const firstLetter = getFirstLetter(trimmed);
                const targetLetter = normalizeArabic(letter);
                return firstLetter === targetLetter;
            }

            // ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠÙˆØ¬Ø¯ ÙˆØ³ÙŠÙ„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            const hasWorker = WORKER_URL && WORKER_URL.trim() !== "";
            const hasApiKey = GEMINI_API_KEY && GEMINI_API_KEY.trim() !== "";

            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Worker Ø£Ùˆ API KeyØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
            if (!hasWorker && !hasApiKey) {
                categories.forEach(cat => {
                    const answer = answers[cat.id] || '';
                    const isValid = basicValidation(answer, letter);
                    results[cat.id] = { answer, valid: isValid, points: isValid ? 10 : 0 };
                    totalScore += isValid ? 10 : 0;
                });
                return { score: totalScore, results };
            }

            // Build strict prompt for Gemini
            const prompt = `Ø£Ù†Øª Ù…Ø¯Ù‚Ù‚ ØµØ§Ø±Ù… Ù„Ù„ØºØ§ÙŠØ© Ù„Ø¹Ø¨Ø© "Ø§Ø³Ù… Ø­ÙŠÙˆØ§Ù† Ù†Ø¨Ø§Øª Ø¬Ù…Ø§Ø¯ Ø¨Ù„Ø§Ø¯". 
Ø§Ù„Ø­Ø±Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù‡Ùˆ: "${letter}"

âš ï¸ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØµØ§Ø±Ù…Ø© Ø¬Ø¯Ø§Ù‹ - Ø§ØªØ¨Ø¹Ù‡Ø§ Ø¨Ø¯Ù‚Ø©:

1. âœ… ÙŠØ¬Ø¨ Ø£Ù† ØªØ¨Ø¯Ø£ Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø­Ø±Ù "${letter}" Ø¨Ø§Ù„Ø¶Ø¨Ø· (Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø£Ù† Ø£/Ø¥/Ø¢ = Ø§ØŒ ÙˆØªØ¬Ø§Ù‡Ù„ "Ø§Ù„" Ø§Ù„ØªØ¹Ø±ÙŠÙ ÙÙ‚Ø·)
2. âœ… ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„ÙƒÙ„Ù…Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© ÙˆÙ…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
3. âœ… ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¨Ø§Ù„Ø¶Ø¨Ø·:
   - Ø§Ø³Ù… ÙˆÙ„Ø¯: Ø§Ø³Ù… Ø°ÙƒØ± Ø­Ù‚ÙŠÙ‚ÙŠ (Ø£Ø­Ù…Ø¯ØŒ Ù…Ø­Ù…Ø¯ØŒ Ø¹Ù„ÙŠØŒ Ø¹Ù…Ø±...)
   - Ø§Ø³Ù… Ø¨Ù†Øª: Ø§Ø³Ù… Ø£Ù†Ø«Ù‰ Ø­Ù‚ÙŠÙ‚ÙŠ (ÙØ§Ø·Ù…Ø©ØŒ Ù…Ø±ÙŠÙ…ØŒ Ø³Ø§Ø±Ø©ØŒ Ù‡Ù†Ø¯...)
   - Ø®Ø¶Ø§Ø±: Ù†ÙˆØ¹ Ø®Ø¶Ø§Ø± ÙÙ‚Ø· (Ø®ÙŠØ§Ø±ØŒ Ø·Ù…Ø§Ø·Ù…ØŒ Ø¨ØµÙ„ØŒ Ø¬Ø²Ø±...) - Ù„ÙŠØ³ Ø§Ø³Ù… Ø£Ùˆ ÙØ§ÙƒÙ‡Ø©
   - ÙÙˆØ§ÙƒÙ‡: Ù†ÙˆØ¹ ÙØ§ÙƒÙ‡Ø© ÙÙ‚Ø· (ØªÙØ§Ø­ØŒ Ù…ÙˆØ²ØŒ Ø¨Ø±ØªÙ‚Ø§Ù„...) - Ù„ÙŠØ³ Ø®Ø¶Ø§Ø±
   - Ø¬Ù…Ø§Ø¯: Ø´ÙŠØ¡ ØºÙŠØ± Ø­ÙŠ Ù…Ù„Ù…ÙˆØ³ (ÙƒØ±Ø³ÙŠØŒ Ø·Ø§ÙˆÙ„Ø©ØŒ Ù‚Ù„Ù…...)
   - Ø­ÙŠÙˆØ§Ù†: Ø§Ø³Ù… Ø­ÙŠÙˆØ§Ù† Ø­Ù‚ÙŠÙ‚ÙŠ (Ø£Ø³Ø¯ØŒ ÙÙŠÙ„ØŒ Ù‚Ø·Ø©ØŒ ÙƒÙ„Ø¨...)
   - Ø¨Ù„Ø§Ø¯: Ø§Ø³Ù… Ø¯ÙˆÙ„Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© (Ù…ØµØ±ØŒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŒ Ù„Ø¨Ù†Ø§Ù†...)
   - Ù…Ø¯ÙŠÙ†Ø©: Ø§Ø³Ù… Ù…Ø¯ÙŠÙ†Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© (Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©ØŒ Ø¯Ø¨ÙŠØŒ Ø¹Ù…Ø§Ù†...)
   - Ù…Ù‡Ù†Ø©: Ø§Ø³Ù… Ù…Ù‡Ù†Ø©/ÙˆØ¸ÙŠÙØ© (Ø·Ø¨ÙŠØ¨ØŒ Ù…Ù‡Ù†Ø¯Ø³ØŒ Ù…Ø¹Ù„Ù…...)

âŒ Ø£Ø¹Ø· false Ø¥Ø°Ø§:
- Ø§Ù„ÙƒÙ„Ù…Ø© Ù„Ø§ ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„Ø­Ø±Ù ${letter}
- Ø§Ù„ÙƒÙ„Ù…Ø© Ù„Ø§ ØªÙ†ØªÙ…ÙŠ Ù„Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (Ù…Ø«Ù„Ø§Ù‹: Ø§Ø³Ù… ÙÙŠ Ø®Ø§Ù†Ø© Ø®Ø¶Ø§Ø±)
- Ø§Ù„ÙƒÙ„Ù…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
- Ø§Ù„ÙƒÙ„Ù…Ø© Ø­Ø±Ù ÙˆØ§Ø­Ø¯ Ø£Ùˆ Ø­Ø±ÙˆÙ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©

Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ù„Ù„ØªØ­Ù‚Ù‚:
${categories.map(cat => `- ${cat.prompt}: "${answers[cat.id] || 'ÙØ§Ø±Øº'}"`).join('\n')}

Ø£Ø¬Ø¨ Ø¨Ù€ JSON ÙÙ‚Ø·:
{"boyName":{"valid":true/false},"girlName":{"valid":true/false},"vegetable":{"valid":true/false},"fruit":{"valid":true/false},"object":{"valid":true/false},"animal":{"valid":true/false},"country":{"valid":true/false},"city":{"valid":true/false},"job":{"valid":true/false}}`;

            try {
                let response;
                let text = '';

                if (hasWorker) {
                    response = await fetch(WORKER_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: prompt })
                    });

                    const data = await response.json();

                    // Worker ÙŠØ±Ø¬Ø¹ Ø§Ù„Ù†Øµ Ù…Ø¨Ø§Ø´Ø±Ø© Ø£Ùˆ ÙÙŠ candidates
                    if (data.candidates) {
                        text = data.candidates[0]?.content?.parts?.[0]?.text || '';
                    } else if (data.text) {
                        text = data.text;
                    } else if (typeof data === 'string') {
                        text = data;
                    } else {
                        text = JSON.stringify(data);
                    }
                } else {
                    response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { temperature: 0.1 }
                        })
                    });
                    const data = await response.json();
                    text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
                }

                const jsonMatch = text.match(/\{[\s\S]*\}/);

                if (jsonMatch) {
                    const aiResults = JSON.parse(jsonMatch[0]);

                    categories.forEach(cat => {
                        const answer = answers[cat.id] || '';
                        const trimmedAnswer = answer.trim();
                        const meetsMinLength = trimmedAnswer.length >= MIN_WORD_LENGTH;
                        const startsWithCorrectLetter = basicValidation(answer, letter);
                        const aiSaysValid = aiResults[cat.id]?.valid === true;
                        const isValid = meetsMinLength && startsWithCorrectLetter && aiSaysValid;
                        results[cat.id] = { answer, valid: isValid, points: isValid ? 10 : 0 };
                        totalScore += isValid ? 10 : 0;
                    });
                    return { score: totalScore, results };
                }
            } catch (error) {
                console.error('AI verification error:', error.message);
            }

            // Fallback to basic verification
            categories.forEach(cat => {
                const answer = answers[cat.id] || '';
                const isValid = basicValidation(answer, letter);
                results[cat.id] = { answer, valid: isValid, points: isValid ? 10 : 0 };
                totalScore += isValid ? 10 : 0;
            });
            return { score: totalScore, results };
        }

        // Firebase Functions
        async function createRoom(name) {
            const code = generateRoomCode();
            currentPlayerId = generatePlayerId();
            playerName = name; isHost = true;
            await database.ref('rooms/' + code).set({
                code, status: 'waiting', letter: '', timer: 60, stoppedBy: '',
                players: { [currentPlayerId]: { name, isHost: true, answers: {}, score: 0 } }
            });
            currentRoomId = code;
            return code;
        }

        async function joinRoom(code, name) {
            const snap = await database.ref('rooms/' + code).once('value');
            if (!snap.exists()) throw new Error('Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
            const room = snap.val();
            if (room.status !== 'waiting') throw new Error('Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¯Ø£Øª');
            if (Object.keys(room.players || {}).length >= 2) throw new Error('Ø§Ù„ØºØ±ÙØ© Ù…Ù…ØªÙ„Ø¦Ø©');
            currentPlayerId = generatePlayerId();
            playerName = name; isHost = false;
            await database.ref(`rooms/${code}/players/${currentPlayerId}`).set({ name, isHost: false, answers: {}, score: 0 });
            currentRoomId = code;
        }

        async function startGame() {
            if (!currentRoomId || !isHost) return;
            await database.ref('rooms/' + currentRoomId).update({ status: 'playing', letter: getRandomLetter(), timer: 60, stoppedBy: '' });
        }

        function getAnswers() {
            const answers = {};
            categories.forEach(cat => { answers[cat.id] = document.getElementById('input-' + cat.id)?.value?.trim() || ''; });
            return answers;
        }

        async function submitAnswers() {
            if (!currentRoomId || !currentPlayerId) return;
            await database.ref(`rooms/${currentRoomId}/players/${currentPlayerId}/answers`).set(getAnswers());
        }

        async function pressStop() {
            if (!currentRoomId) return;
            await submitAnswers();
            await database.ref('rooms/' + currentRoomId).update({ status: 'finished', stoppedBy: playerName });
        }

        function cleanup() {
            if (gameTimerInterval) { clearInterval(gameTimerInterval); gameTimerInterval = null; }
            if (currentRoomId) database.ref('rooms/' + currentRoomId).off();
            currentRoomId = null; currentPlayerId = null; isHost = false;
        }

        async function leaveRoom() {
            if (currentRoomId && currentPlayerId) {
                await database.ref(`rooms/${currentRoomId}/players/${currentPlayerId}`).remove();
                if (isHost) await database.ref('rooms/' + currentRoomId).remove();
            }
            cleanup();
        }

        // Timer
        function startTimer(initial) {
            if (gameTimerInterval) clearInterval(gameTimerInterval);
            currentTimeLeft = initial;
            const timerEl = document.getElementById('timer-value');
            timerEl.textContent = currentTimeLeft;
            timerEl.className = 'timer-value';

            gameTimerInterval = setInterval(async () => {
                currentTimeLeft--;
                timerEl.textContent = currentTimeLeft;
                if (currentTimeLeft <= 10) timerEl.className = 'timer-value danger';
                else if (currentTimeLeft <= 20) timerEl.className = 'timer-value warning';
                else timerEl.className = 'timer-value';

                if (currentTimeLeft <= 0) {
                    clearInterval(gameTimerInterval);
                    gameTimerInterval = null;
                    await submitAnswers();
                    if (isHost) await database.ref('rooms/' + currentRoomId).update({ status: 'finished', stoppedBy: 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª' });
                }
            }, 1000);
        }

        // Room Listener
        let resultsShown = false; // Ù„Ù…Ù†Ø¹ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø±Ø©

        function listenToRoom() {
            database.ref('rooms/' + currentRoomId).on('value', async snap => {
                if (!snap.exists()) { showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØºØ±ÙØ©', 'error'); cleanup(); showScreen('welcome'); return; }
                const room = snap.val();
                const count = Object.keys(room.players || {}).length;
                const countEl = document.getElementById('players-count');
                if (countEl) countEl.textContent = `Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†: ${count}/2`;

                if (room.status === 'waiting' && count === 2 && isHost) {
                    resultsShown = false; // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    setTimeout(startGame, 1000);
                }
                else if (room.status === 'playing') {
                    resultsShown = false; // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·
                    showGameScreen(room);
                }
                else if (room.status === 'finished' && !resultsShown) {
                    resultsShown = true;
                    // Ø£ÙˆÙ„Ø§Ù‹: Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ø§Ø¹Ø¨ (Ù…Ù‡Ù… Ù„Ù„Ø¶ÙŠÙ!)
                    await submitAnswers();
                    // Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    await new Promise(resolve => setTimeout(resolve, 500));
                    // Ø¥Ø¹Ø§Ø¯Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
                    const freshSnap = await database.ref('rooms/' + currentRoomId).once('value');
                    if (freshSnap.exists()) {
                        await showResultsScreen(freshSnap.val());
                    }
                }
            });
        }

        let gameStarted = false; // Ù…ØªØºÙŠØ± Ù„ØªØªØ¨Ø¹ Ù…Ø§ Ø¥Ø°Ø§ Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©

        function showGameScreen(room) {
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„ÙŠØ³Øª Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©ØŒ Ø£Ø¹Ø¯ Ø¶Ø¨Ø· ÙƒÙ„ Ø´ÙŠØ¡
            if (!screens.game.classList.contains('active')) {
                gameStarted = false;
            }

            showScreen('game');
            document.getElementById('current-letter').textContent = room.letter;

            // Ø£Ø¹Ø¯ Ø¶Ø¨Ø· Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
            if (!gameStarted) {
                document.querySelectorAll('.category-input').forEach(inp => {
                    inp.disabled = false;
                    inp.value = '';
                });
                gameStarted = true;
            }

            document.getElementById('stop-btn').disabled = false;
            if (!gameTimerInterval) startTimer(room.timer || 60);
        }

        async function showResultsScreen(room) {
            if (gameTimerInterval) { clearInterval(gameTimerInterval); gameTimerInterval = null; }
            document.querySelectorAll('.category-input').forEach(inp => inp.disabled = true);
            document.getElementById('stop-btn').disabled = true;
            showScreen('results');

            const container = document.getElementById('results-container');
            container.innerHTML = '<div class="ai-loading"><div class="ai-loading-spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª...</p></div>';

            const players = room.players || {};
            const letter = room.letter;
            const results = [];

            for (const [pid, pdata] of Object.entries(players)) {
                const { score, results: ansResults } = await verifyWithAI(pdata.answers || {}, letter);
                results.push({ id: pid, name: pdata.name, score, answers: ansResults, isMe: pid === currentPlayerId });
            }
            results.sort((a, b) => b.score - a.score);

            const banner = document.getElementById('winner-banner');
            if (results.length >= 2) {
                if (results[0].score > results[1].score) { banner.textContent = `ğŸ‰ Ø§Ù„ÙØ§Ø¦Ø²: ${results[0].name} Ø¨Ù€ ${results[0].score} Ù†Ù‚Ø·Ø©!`; banner.style.display = 'block'; }
                else if (results[0].score === results[1].score) { banner.textContent = 'ğŸ¤ ØªØ¹Ø§Ø¯Ù„!'; banner.style.display = 'block'; }
                else banner.style.display = 'none';
            } else banner.style.display = 'none';

            container.innerHTML = results.map(p => `
                <div class="player-results" style="${p.isMe ? 'border-color:var(--accent-blue);' : ''}">
                    <div class="player-header">
                        <span class="player-name">${p.isMe ? 'ğŸ‘¤ ' : ''}${p.name}</span>
                        <span class="player-score">${p.score} Ù†Ù‚Ø·Ø©</span>
                    </div>
                    <div class="answers-grid">
                        ${categories.map(cat => {
                const a = p.answers[cat.id] || { answer: '-', valid: false, points: 0 };
                return `<div class="answer-item">
                                <div class="answer-category">${cat.label}</div>
                                <div class="answer-value ${a.valid ? 'correct' : 'wrong'}">${a.answer || '-'}</div>
                                <div class="answer-points ${a.points > 0 ? 'positive' : ''}">${a.points > 0 ? '+10' : '0'}</div>
                            </div>`;
            }).join('')}
                    </div>
                </div>
            `).join('');

            if (room.stoppedBy) showToast(`${room.stoppedBy} Ø£Ù†Ù‡Ù‰ Ø§Ù„Ø¬ÙˆÙ„Ø©!`);
        }

        async function playAgain() {
            if (!isHost) { showToast('ÙÙ‚Ø· Ø§Ù„Ù…Ø¶ÙŠÙ ÙŠÙ…ÙƒÙ†Ù‡ Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'error'); return; }
            gameStarted = false; // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØªØºÙŠØ± Ù„Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            resultsShown = false; // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            const snap = await database.ref('rooms/' + currentRoomId).once('value');
            const room = snap.val();
            const updates = { status: 'playing', letter: getRandomLetter(), timer: 60, stoppedBy: '' };
            for (const pid of Object.keys(room.players || {})) { updates[`players/${pid}/answers`] = {}; updates[`players/${pid}/score`] = 0; }
            await database.ref('rooms/' + currentRoomId).update(updates);
        }

        // Event Listeners
        document.getElementById('create-room-btn').onclick = () => { showScreen('room'); document.getElementById('create-room-card').style.display = 'block'; document.getElementById('join-room-card').style.display = 'none'; };
        document.getElementById('join-room-btn').onclick = () => { showScreen('room'); document.getElementById('create-room-card').style.display = 'none'; document.getElementById('join-room-card').style.display = 'block'; };
        document.getElementById('back-to-welcome').onclick = () => showScreen('welcome');

        document.getElementById('confirm-create-room').onclick = async () => {
            const name = document.getElementById('create-player-name').value.trim();
            if (!name) { showToast('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ', 'error'); return; }
            try {
                const code = await createRoom(name);
                document.getElementById('room-code-display').textContent = code;
                document.getElementById('created-room-info').style.display = 'block';
                document.getElementById('waiting-room-code').textContent = code;
                showScreen('waiting');
                listenToRoom();
                showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©!');
            } catch (e) { showToast('Ø®Ø·Ø£: ' + e.message, 'error'); }
        };

        document.getElementById('copy-room-code').onclick = () => { navigator.clipboard.writeText(document.getElementById('room-code-display').textContent); showToast('ØªÙ… Ø§Ù„Ù†Ø³Ø®!'); };

        document.getElementById('confirm-join-room').onclick = async () => {
            const name = document.getElementById('join-player-name').value.trim();
            const code = document.getElementById('room-code-input').value.trim().toUpperCase();
            if (!name) { showToast('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ', 'error'); return; }
            if (!code) { showToast('Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©', 'error'); return; }
            try {
                await joinRoom(code, name);
                document.getElementById('waiting-room-code').textContent = code;
                showScreen('waiting');
                listenToRoom();
                showToast('ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…!');
            } catch (e) { showToast(e.message, 'error'); }
        };

        document.getElementById('leave-room-btn').onclick = async () => { await leaveRoom(); showScreen('welcome'); };
        document.getElementById('stop-btn').onclick = pressStop;
        document.getElementById('play-again-btn').onclick = playAgain;
        document.getElementById('exit-game-btn').onclick = async () => { await leaveRoom(); showScreen('welcome'); };

        // ==================== FRIENDS SYSTEM ====================

        // User ID Management - Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…ÙˆØ¬ÙˆØ¯
        let myUserId = localStorage.getItem('wordGameUserId');
        if (!myUserId) {
            myUserId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 8);
            localStorage.setItem('wordGameUserId', myUserId);
        }

        let myUserName = localStorage.getItem('wordGameUserName') || '';
        let currentInvite = null;
        let inviteTimeout = null;
        let inviteCountdownInterval = null;
        let userInitialized = false;

        // Initialize user in Firebase - ÙŠÙÙ†Ø´Ø¦/ÙŠÙØ­Ø¯Ù‘Ø« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function initializeUser(name) {
            if (!name) return;
            myUserName = name;
            localStorage.setItem('wordGameUserName', name);

            console.log('Initializing user:', myUserId, name);

            database.ref('users/' + myUserId).update({
                name: name,
                online: true,
                lastSeen: Date.now()
            }).then(() => {
                console.log('User initialized in Firebase');
                userInitialized = true;
            }).catch(err => {
                console.error('Error initializing user:', err);
            });

            // Set offline on disconnect
            database.ref('users/' + myUserId + '/online').onDisconnect().set(false);
            database.ref('users/' + myUserId + '/lastSeen').onDisconnect().set(Date.now());
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… Ù…Ø­ÙÙˆØ¸Ø§Ù‹
        if (myUserName) {
            initializeUser(myUserName);
        }

        // Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³Ù… Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
        function ensureUserName() {
            if (myUserName) return true;

            const name = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±:');
            if (name && name.trim()) {
                initializeUser(name.trim());
                return true;
            }
            showToast('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹', 'error');
            return false;
        }

        // Listen for invites
        function listenForInvites() {
            database.ref('roomInvites/' + myUserId).on('child_added', snap => {
                const invite = snap.val();
                if (!invite || Date.now() - invite.timestamp > 20000) {
                    snap.ref.remove();
                    return;
                }
                currentInvite = { ...invite, key: snap.key };
                showInviteModal(invite);
            });
        }

        // Listen for friend requests
        function listenForFriendRequests() {
            database.ref('friendRequests/' + myUserId).on('value', snap => {
                const requests = snap.val() || {};
                const count = Object.keys(requests).length;
                updateNotificationBadge(count);
                renderRequests(requests);
            });
        }

        // Update notification badge
        function updateNotificationBadge(count) {
            const badge = document.getElementById('notification-badge');
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        // Show invite modal
        function showInviteModal(invite) {
            document.getElementById('invite-message').textContent =
                `${invite.fromName} ÙŠØ¯Ø¹ÙˆÙƒ Ù„Ù„Ø¹Ø¨ Ù…Ø¹Ù‡!`;
            document.getElementById('invite-modal').classList.add('show');
        }

        // Hide invite modal
        function hideInviteModal() {
            document.getElementById('invite-modal').classList.remove('show');
            if (currentInvite) {
                database.ref(`roomInvites/${myUserId}/${currentInvite.key}`).remove();
                currentInvite = null;
            }
        }

        // Accept invite
        document.getElementById('accept-invite').onclick = async () => {
            if (!currentInvite || !currentInvite.roomId) {
                showToast('Ø§Ù„Ø¯Ø¹ÙˆØ© ØºÙŠØ± ØµØ§Ù„Ø­Ø©', 'error');
                hideInviteModal();
                return;
            }

            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø©
            const inviteRoomId = currentInvite.roomId;
            const inviteKey = currentInvite.key;

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ­Ø°Ù Ø§Ù„Ø¯Ø¹ÙˆØ©
            document.getElementById('invite-modal').classList.remove('show');
            database.ref(`roomInvites/${myUserId}/${inviteKey}`).remove();
            currentInvite = null;

            // Set player name if needed
            if (!myUserName) {
                myUserName = 'Ù„Ø§Ø¹Ø¨';
            }

            try {
                await joinRoom(inviteRoomId, myUserName);
                document.getElementById('waiting-room-code').textContent = inviteRoomId;
                showScreen('waiting');
                listenToRoom();
                showToast('ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…!');
            } catch (e) {
                showToast(e.message, 'error');
            }
        };

        // Reject invite
        document.getElementById('reject-invite').onclick = () => {
            hideInviteModal();
        };

        // Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØ© ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª
        async function createRoomAndInvite(friendId, friendName) {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø§Ø³Ù…ØŒ Ø§Ø·Ù„Ø¨Ù‡
            if (!myUserName) {
                const name = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:');
                if (!name || !name.trim()) {
                    showToast('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                    return;
                }
                initializeUser(name.trim());
            }

            try {
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ sidebar
                closeFriendsSidebar();

                // Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
                showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©...');
                await createRoom(myUserName);

                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯Ø¹ÙˆØ©
                await database.ref(`roomInvites/${friendId}/${Date.now()}`).set({
                    roomId: currentRoomId,
                    from: myUserId,
                    fromName: myUserName,
                    timestamp: Date.now()
                });

                // Ø¹Ø±Ø¶ Ø§Ù„ØºØ±ÙØ©
                document.getElementById('waiting-room-code').textContent = currentRoomId;
                showScreen('waiting');
                listenToRoom();

                // Show waiting modal
                document.getElementById('invited-friend-name').textContent = friendName;
                document.getElementById('invite-waiting-modal').classList.add('show');

                let countdown = 30;
                document.getElementById('invite-countdown').textContent = countdown;

                inviteCountdownInterval = setInterval(() => {
                    countdown--;
                    document.getElementById('invite-countdown').textContent = countdown;
                    if (countdown <= 0) {
                        clearInterval(inviteCountdownInterval);
                    }
                }, 1000);

                // Listen for room to become full
                const roomRef = database.ref('rooms/' + currentRoomId);
                const roomListener = roomRef.on('value', snap => {
                    const room = snap.val();
                    if (room && Object.keys(room.players || {}).length >= 2) {
                        clearTimeout(inviteTimeout);
                        clearInterval(inviteCountdownInterval);
                        document.getElementById('invite-waiting-modal').classList.remove('show');
                        roomRef.off('value', roomListener);
                        showToast('Ø§Ù†Ø¶Ù… ØµØ¯ÙŠÙ‚Ùƒ! ğŸ‰');
                    }
                });

                // Timeout
                inviteTimeout = setTimeout(() => {
                    clearInterval(inviteCountdownInterval);
                    document.getElementById('invite-waiting-modal').classList.remove('show');
                    roomRef.off('value', roomListener);
                    showToast('ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© ÙŠØ¯ÙˆÙŠØ§Ù‹: ' + currentRoomId, 'error');
                }, 30000);

            } catch (error) {
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }

        // Send invite to friend (if already in a room)
        async function sendInviteToFriend(friendId, friendName) {
            if (!currentRoomId) {
                // Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØ©
                await createRoomAndInvite(friendId, friendName);
                return;
            }

            // Send invite
            await database.ref(`roomInvites/${friendId}/${Date.now()}`).set({
                roomId: currentRoomId,
                from: myUserId,
                fromName: myUserName,
                timestamp: Date.now()
            });

            // Show waiting modal
            document.getElementById('invited-friend-name').textContent = friendName;
            document.getElementById('invite-waiting-modal').classList.add('show');

            let countdown = 15;
            document.getElementById('invite-countdown').textContent = countdown;

            inviteCountdownInterval = setInterval(() => {
                countdown--;
                document.getElementById('invite-countdown').textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(inviteCountdownInterval);
                }
            }, 1000);

            // Listen for room to become full
            const roomRef = database.ref('rooms/' + currentRoomId);
            const roomListener = roomRef.on('value', snap => {
                const room = snap.val();
                if (room && Object.keys(room.players || {}).length >= 2) {
                    // Friend joined!
                    clearTimeout(inviteTimeout);
                    clearInterval(inviteCountdownInterval);
                    document.getElementById('invite-waiting-modal').classList.remove('show');
                    roomRef.off('value', roomListener);
                    closeFriendsSidebar();
                }
            });

            // Timeout - fallback to room code
            inviteTimeout = setTimeout(() => {
                clearInterval(inviteCountdownInterval);
                document.getElementById('invite-waiting-modal').classList.remove('show');
                roomRef.off('value', roomListener);
                showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø±Ø¯ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© ÙŠØ¯ÙˆÙŠÙ‹Ø§', 'error');
            }, 15000);
        }

        // Cancel invite
        document.getElementById('cancel-invite').onclick = () => {
            clearTimeout(inviteTimeout);
            clearInterval(inviteCountdownInterval);
            document.getElementById('invite-waiting-modal').classList.remove('show');
        };

        // Send friend request
        async function sendFriendRequest(friendId) {
            // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹
            if (!ensureUserName()) return;

            if (!friendId || friendId === myUserId) {
                showToast('Ù…Ø¹Ø±Ù‘Ù ØºÙŠØ± ØµØ§Ù„Ø­', 'error');
                return;
            }

            // Check if user exists
            const userSnap = await database.ref('users/' + friendId).once('value');
            if (!userSnap.exists()) {
                showToast('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }

            // Check if already friends
            const friendSnap = await database.ref(`users/${myUserId}/friends/${friendId}`).once('value');
            if (friendSnap.exists()) {
                showToast('Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØµØ¯ÙŠÙ‚Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                return;
            }

            // Send request
            await database.ref(`friendRequests/${friendId}/${myUserId}`).set({
                name: myUserName || 'Ù„Ø§Ø¹Ø¨',
                timestamp: Date.now()
            });

            showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø©!');
            document.getElementById('friend-id-input').value = '';
        }

        // Accept friend request
        async function acceptFriendRequest(fromUserId, fromName) {
            // Add to both users' friends list
            await database.ref(`users/${myUserId}/friends/${fromUserId}`).set({
                name: fromName,
                addedAt: Date.now()
            });
            await database.ref(`users/${fromUserId}/friends/${myUserId}`).set({
                name: myUserName || 'Ù„Ø§Ø¹Ø¨',
                addedAt: Date.now()
            });

            // Remove request
            await database.ref(`friendRequests/${myUserId}/${fromUserId}`).remove();

            showToast(`${fromName} Ø£ØµØ¨Ø­ ØµØ¯ÙŠÙ‚Ùƒ!`);
            renderFriendsList();
        }

        // Reject friend request
        async function rejectFriendRequest(fromUserId) {
            await database.ref(`friendRequests/${myUserId}/${fromUserId}`).remove();
        }

        // Render friends list
        async function renderFriendsList() {
            const container = document.getElementById('friends-list');
            const friendsSnap = await database.ref(`users/${myUserId}/friends`).once('value');
            const friends = friendsSnap.val() || {};
            const friendIds = Object.keys(friends);

            if (friendIds.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ‘¥</div>
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¨Ø¹Ø¯<br>Ø£Ø¶Ù Ø£ØµØ¯Ù‚Ø§Ø¡ Ù…Ù† ØªØ¨ÙˆÙŠØ¨ "Ø¥Ø¶Ø§ÙØ©"</p>
                    </div>
                `;
                return;
            }

            let html = '';
            for (const fid of friendIds) {
                const userSnap = await database.ref('users/' + fid).once('value');
                const user = userSnap.val() || { name: friends[fid].name, online: false };

                html += `
                    <div class="friend-card">
                        <div class="friend-info">
                            <div class="friend-avatar">${user.name?.charAt(0) || '?'}</div>
                            <div>
                                <div class="friend-name">${user.name || 'Ù„Ø§Ø¹Ø¨'}</div>
                                <div class="friend-status ${user.online ? 'online' : ''}">
                                    ${user.online ? 'ğŸŸ¢ Ù…ØªØµÙ„' : 'âš« ØºÙŠØ± Ù…ØªØµÙ„'}
                                </div>
                            </div>
                        </div>
                        <div class="friend-actions">
                            ${currentRoomId && user.online ?
                        `<button class="btn-invite" onclick="sendInviteToFriend('${fid}', '${user.name}')" title="Ø¯Ø¹ÙˆØ© Ù„Ù„Ø¹Ø¨">ğŸ®</button>`
                        : ''}
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        // Render requests
        function renderRequests(requests) {
            const container = document.getElementById('requests-list');
            const requestIds = Object.keys(requests);

            if (requestIds.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“­</div>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØµØ¯Ø§Ù‚Ø©</p>
                    </div>
                `;
                return;
            }

            let html = '';
            for (const rid of requestIds) {
                const req = requests[rid];
                html += `
                    <div class="friend-card">
                        <div class="friend-info">
                            <div class="friend-avatar">${req.name?.charAt(0) || '?'}</div>
                            <div>
                                <div class="friend-name">${req.name || 'Ù„Ø§Ø¹Ø¨'}</div>
                                <div class="friend-status">ÙŠØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙƒ</div>
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="btn-accept" onclick="acceptFriendRequest('${rid}', '${req.name}')">âœ“</button>
                            <button class="btn-reject" onclick="rejectFriendRequest('${rid}')">âœ•</button>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        // Sidebar controls
        function openFriendsSidebar() {
            // Ø¹Ø±Ø¶ Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('my-user-id').textContent = myUserId;

            document.getElementById('friends-sidebar').classList.add('open');
            document.getElementById('sidebar-overlay').classList.add('show');
            renderFriendsList();
        }

        function closeFriendsSidebar() {
            document.getElementById('friends-sidebar').classList.remove('open');
            document.getElementById('sidebar-overlay').classList.remove('show');
        }

        document.getElementById('friends-toggle').onclick = openFriendsSidebar;
        document.getElementById('close-sidebar').onclick = closeFriendsSidebar;
        document.getElementById('sidebar-overlay').onclick = closeFriendsSidebar;

        // Tab switching
        document.querySelectorAll('.friends-tab').forEach(tab => {
            tab.onclick = () => {
                document.querySelectorAll('.friends-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                const tabName = tab.dataset.tab;
                document.getElementById('friends-list').style.display = tabName === 'friends' ? 'block' : 'none';
                document.getElementById('requests-list').style.display = tabName === 'requests' ? 'block' : 'none';
                document.getElementById('my-id-section').style.display = tabName === 'add' ? 'block' : 'none';
                document.getElementById('add-friend-section').style.display = tabName === 'add' ? 'flex' : 'none';

                if (tabName === 'friends') renderFriendsList();
            };
        });

        // Copy my ID
        document.getElementById('copy-my-id').onclick = () => {
            navigator.clipboard.writeText(myUserId);
            showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø¹Ø±Ù‘Ù!');
        };

        // Display my ID
        document.getElementById('my-user-id').textContent = myUserId;

        // Send friend request button
        document.getElementById('send-friend-request').onclick = () => {
            const friendId = document.getElementById('friend-id-input').value.trim();
            sendFriendRequest(friendId);
        };

        // Initialize invites listener
        listenForInvites();
        listenForFriendRequests();

        // Update user when creating/joining room
        const originalCreateRoom = createRoom;
        createRoom = async (name) => {
            initializeUser(name);
            const code = await originalCreateRoom(name);
            await database.ref('users/' + myUserId + '/currentRoom').set(code);
            return code;
        };

        const originalJoinRoom = joinRoom;
        joinRoom = async (code, name) => {
            initializeUser(name);
            await originalJoinRoom(code, name);
            await database.ref('users/' + myUserId + '/currentRoom').set(code);
        };

        const originalLeaveRoom = leaveRoom;
        leaveRoom = async () => {
            await originalLeaveRoom();
            await database.ref('users/' + myUserId + '/currentRoom').set(null);
        };

        // Set offline on page unload
        window.onbeforeunload = () => {
            if (currentRoomId && currentPlayerId) {
                database.ref(`rooms/${currentRoomId}/players/${currentPlayerId}`).remove();
            }
            database.ref('users/' + myUserId + '/online').set(false);
        };

        // ==================== END FRIENDS SYSTEM ====================

        // ==================== CHAT SYSTEM ====================

        let currentChatId = null;
        let currentChatFriendId = null;
        let currentChatFriendName = null;
        let chatListener = null;
        let typingTimeout = null;
        let loadedMessages = new Set();

        // Generate consistent chat ID
        function getChatId(userA, userB) {
            return [userA, userB].sort().join('_');
        }

        // Open chat with friend
        function openChat(friendId, friendName) {
            currentChatFriendId = friendId;
            currentChatFriendName = friendName;
            currentChatId = getChatId(myUserId, friendId);

            // Update header
            document.getElementById('chat-friend-name').textContent = friendName;
            document.getElementById('chat-avatar').textContent = friendName?.charAt(0) || '?';

            // Clear messages and show empty state
            document.getElementById('chat-messages').innerHTML = `
                <div class="chat-empty">
                    <div>
                        <div class="icon">ğŸ’¬</div>
                        <p>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ ${friendName}!</p>
                    </div>
                </div>
            `;
            loadedMessages.clear();

            // Show panel
            document.getElementById('chat-panel').classList.remove('hidden');

            // Close sidebar
            closeFriendsSidebar();

            // Start listening
            listenToChat();

            // Focus input
            document.getElementById('chat-input').focus();
        }

        // Close chat
        function closeChat() {
            document.getElementById('chat-panel').classList.add('hidden');

            if (chatListener && currentChatId) {
                database.ref(`chats/${currentChatId}/messages`).off('child_added', chatListener);
                chatListener = null;
            }

            currentChatId = null;
            currentChatFriendId = null;
        }

        // Listen to chat messages (real-time)
        function listenToChat() {
            if (!currentChatId) return;

            const messagesRef = database.ref(`chats/${currentChatId}/messages`);

            if (chatListener) {
                messagesRef.off('child_added', chatListener);
            }

            chatListener = messagesRef.orderByChild('timestamp').limitToLast(100).on('child_added', snap => {
                const msg = snap.val();
                const msgId = snap.key;

                if (!loadedMessages.has(msgId)) {
                    loadedMessages.add(msgId);
                    renderMessage(msg);
                }
            });

            // Listen for typing indicator
            database.ref(`chats/${currentChatId}/typing/${currentChatFriendId}`).on('value', snap => {
                const isTyping = snap.val();
                document.getElementById('chat-typing').style.display = isTyping ? 'block' : 'none';
            });
        }

        // Send message
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();

            if (!text || !currentChatId) return;

            database.ref(`chats/${currentChatId}/messages`).push({
                from: myUserId,
                fromName: myUserName || 'Ù„Ø§Ø¹Ø¨',
                text: text,
                timestamp: Date.now()
            });

            input.value = '';

            // Clear typing indicator
            database.ref(`chats/${currentChatId}/typing/${myUserId}`).set(false);
        }

        // Render message
        function renderMessage(msg) {
            const container = document.getElementById('chat-messages');

            // Remove empty state if exists
            const emptyState = container.querySelector('.chat-empty');
            if (emptyState) emptyState.remove();

            const isMe = msg.from === myUserId;
            const time = formatTime(msg.timestamp);

            const div = document.createElement('div');
            div.className = `chat-message ${isMe ? 'me' : 'friend'}`;
            div.innerHTML = `
                ${msg.text}
                <span class="time">${time}</span>
            `;

            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // Format time
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // Typing indicator
        function handleTyping() {
            if (!currentChatId) return;

            database.ref(`chats/${currentChatId}/typing/${myUserId}`).set(true);

            if (typingTimeout) clearTimeout(typingTimeout);

            typingTimeout = setTimeout(() => {
                database.ref(`chats/${currentChatId}/typing/${myUserId}`).set(false);
            }, 2000);
        }

        // Chat event listeners
        document.getElementById('chat-close').onclick = closeChat;

        document.getElementById('chat-send').onclick = sendMessage;

        document.getElementById('chat-input').onkeypress = (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            } else {
                handleTyping();
            }
        };

        document.getElementById('chat-input').oninput = handleTyping;

        // Update renderFriendsList to include chat button
        const originalRenderFriendsList = renderFriendsList;
        renderFriendsList = async function () {
            const container = document.getElementById('friends-list');
            const friendsSnap = await database.ref(`users/${myUserId}/friends`).once('value');
            const friends = friendsSnap.val() || {};
            const friendIds = Object.keys(friends);

            if (friendIds.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ‘¥</div>
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¨Ø¹Ø¯<br>Ø£Ø¶Ù Ø£ØµØ¯Ù‚Ø§Ø¡ Ù…Ù† ØªØ¨ÙˆÙŠØ¨ "Ø¥Ø¶Ø§ÙØ©"</p>
                    </div>
                `;
                return;
            }

            let html = '';
            for (const fid of friendIds) {
                const userSnap = await database.ref('users/' + fid).once('value');
                const user = userSnap.val() || { name: friends[fid].name, online: false };

                html += `
                    <div class="friend-card">
                        <div class="friend-info">
                            <div class="friend-avatar">${user.name?.charAt(0) || '?'}</div>
                            <div>
                                <div class="friend-name">${user.name || 'Ù„Ø§Ø¹Ø¨'}</div>
                                <div class="friend-status ${user.online ? 'online' : ''}">
                                    ${user.online ? 'ğŸŸ¢ Ù…ØªØµÙ„' : 'âš« ØºÙŠØ± Ù…ØªØµÙ„'}
                                </div>
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="btn-chat" onclick="openChat('${fid}', '${user.name}')" title="Ø¯Ø±Ø¯Ø´Ø©">ğŸ’¬</button>
                            ${user.online ?
                        `<button class="btn-invite" onclick="sendInviteToFriend('${fid}', '${user.name}')" title="Ø¯Ø¹ÙˆØ© Ù„Ù„Ø¹Ø¨">ğŸ®</button>`
                        : ''}
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        };

        // ==================== END CHAT SYSTEM ====================

        // Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù† HTML
        window.openChat = openChat;
        window.sendInviteToFriend = sendInviteToFriend;
        window.acceptFriendRequest = acceptFriendRequest;
        window.rejectFriendRequest = rejectFriendRequest;
        window.sendFriendRequest = sendFriendRequest;
    </script>
</body>

</html>
